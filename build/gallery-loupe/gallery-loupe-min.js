YUI.add("gallery-loupe",function(a){var g=a.Lang,j=g.isNumber,b=a.ClassNameManager.getClassName,d="Loupe",e="loupe",i=b(e,"display"),k=b(e,"hidden");function f(l){f.superclass.constructor.apply(this,arguments);}a.Loupe=a.extend(f,a.Widget,{_image:null,initializer:function(l){this._image={};},renderUI:function(){this._renderDisplay();},bindUI:function(){this._bindEvents();},syncUI:function(){var l=this.get("contentBox"),m=this._image;m.width=parseInt(l.getStyle("width"),10);m.height=parseInt(l.getStyle("height"),10);m.left=l.getX();m.top=l.getY();m.right=m.left+m.width;m.bottom=m.top+m.height;},destructor:function(){this._unbindEvents();this._destroyDisplay();},_bindEvents:function(){var m=this.get("contentBox"),n=this.get("display"),l=this.get("follow");if(!l){this._MM=m.on("mousemove",this._moveViewport,this);this._MO=m.on("mouseout",function(){n.addClass(k);},this);this._ME=m.on("mouseover",function(){n.removeClass(k);},this);}else{this._ME=m.on("mouseover",function(){n.removeClass(k);this._MM=a.one("body").on("mousemove",this._moveViewport,this);},this);}},_unbindEvents:function(){if(this._MM){this._MM.unbind();}if(this._MO){this._MO.unbind();}if(this._ME){this._ME.unbind();}},_destroyDisplay:function(){this.get("display").remove();},_renderDisplay:function(){var o=this.get("display"),l=this.get("height"),n=this.get("width"),m;if(!a.Lang.isValue(o)){o=a.Node.create("<div></div>");this.set("display",o);this.get("contentBox").get("parentNode").append(o);}o.setContent("<div><img /></div>");m=o.one("img");if(a.Lang.isValue(l)){o.setStyle("height",l);}if(a.Lang.isValue(n)){o.setStyle("width",n);}o.setStyle("position","absolute");if(!this.get("follow")){o.setXY([this.get("staticX"),this.get("staticY")]);o.one("div").setStyle("position","relative");}else{o.setXY([0,0]);}o.addClass(i);this._configureImage();o.addClass(k);},_configureImage:function(){var m=this.get("zoom"),o=this.get("display"),n=this.get("contentBox"),l=o.one("img");l.set("src",n.get("src"));l.setStyles({height:this._image.height*m,width:this._image.width*m});},_moveViewport:function(n){var m=this._image,v=this.get("zoom"),o=this.get("display"),q=o.one("div"),r=n.pageX-m.left,p=n.pageY-m.top,t=this.get("height")/2,s=this.get("width")/2,l=-r*v+t,u=-p*v+s;if(n.pageX>=m.left&&n.pageX<=m.right&&n.pageY>=m.top&&n.pageY<=m.bottom){if(this.get("follow")){o.setXY([n.pageX-s,n.pageY-t]);}q.setXY([l,u]);}else{o.addClass(k);this._MM.detach();}}},{NAME:"loupe",NS:"loupe",ATTRS:{srcNode:{validator:function(l){if(!l.test("img")){a.message("Can't be attached to this node.","warn",d);return false;}return true;}},follow:{value:false,validator:g.isBoolean},display:{writeOnce:true,setter:a.one},height:{value:100,validator:j},width:{value:100,validator:j},zoom:{value:2,validator:j},staticX:{validator:j},staticY:{validator:j}}});function h(l){h.superclass.constructor.apply(this,arguments);}h.NAME="lens";h.ATTRS={imageSrc:{},loadingImageSrc:{},imageHeight:{value:0},imageWidth:{value:0},showDelay:{value:0}};h.IMAGE_CLASS=a.ClassNameManager.getClassName(h.NAME,"image");h.LOADING_IMAGE_CLASS=a.ClassNameManager.getClassName(h.NAME,"loading-image");h.IMAGE_TEMPLATE='<img class="'+h.IMAGE_CLASS+'" />';h.LOADING_IMAGE_TEMPLATE='<img class="'+h.LOADING_IMAGE_CLASS+'" />';h.HTML_PARSER={};a.Lens=a.extend(h,a.Overlay,{renderUI:function(){this.get("contentBox").setStyles({"overflow":"hidden","position":"relative"});this._renderLoadingImage();this._renderImage();},bindUI:function(){a.on("load",a.bind(this._onImageLoad,this),this.get("contentBox").one("."+h.IMAGE_CLASS));},_renderLoadingImage:function(){var n,l,m;n=this.get("loadingImageSrc");if(!n){return;}l=this.get("contentBox");m=l.one("."+h.LOADING_IMAGE_CLASS);if(!m){m=a.Node.create(h.LOADING_IMAGE_TEMPLATE);l.appendChild(m);}m.set("src",n).setStyle("display","block");this.loadingImageNode=m;},_renderImage:function(){var l=this.get("contentBox"),m=l.one("."+h.IMAGE_CLASS);if(!m){m=a.Node.create(h.IMAGE_TEMPLATE);l.appendChild(m);m.setStyle("position","absolute");}m.set("src",this.get("imageSrc"));if(this.get("loadingImageSrc")){m.setStyle("display","none");}else{m.setStyle("display","block");}this.imageNode=m;},_onImageLoad:function(m){var l=this.imageNode.get("region");this.loadingImageNode.setStyle("display","none");this.imageNode.setStyle("display","block");this.imageWidth=l.right-l.left;this.imageHeight=l.bottom-l.top;},setOffsets:function(m,l){this.imageNode.setStyle("top",l+"px");this.imageNode.setStyle("left",m+"px");},show:function(){var l=this;this.isShowPending=true;setTimeout(function(){if(l.isShowPending){h.superclass.show.call(l);}},this.get("showDelay"));},hide:function(){this.isShowPending=false;h.superclass.hide.call(this);}});function c(l){c.superclass.constructor.apply(this,arguments);}c.NAME="cursorBox";c.ATTRS={showDelay:{value:0},parentElement:{},extendedBoundary:{}};a.CursorBox=a.extend(c,a.Overlay,{_realWidth:0,_realHeight:0,renderUI:function(){},bindUI:function(){a.on("mousemove",a.bind(this._onMouseMove,this),document.body);},show:function(){var l=this;this.isShowPending=true;setTimeout(function(){if(l.isShowPending){c.superclass.show.call(l);}},this.get("showDelay"));},hide:function(){this.isShowPending=false;c.superclass.hide.call(this);},_onMouseMove:function(t){if(!(this.get("visible")||this.isShowPending)){return false;}var s=[t.pageX,t.pageY],r=this._getBoundary().get("region"),q=this.get("boundingBox").get("region"),n=q.right-q.left,u=q.bottom-q.top,m=r.right-(n/2),p=r.left+(n/2),l=r.bottom-(u/2),o=r.top+(u/2);if(s[0]>m){s[0]=m;}if(s[0]<p){s[0]=p;}if(s[1]>l){s[1]=l;}if(s[1]<o){s[1]=o;}this.setPosition(s);},_getBoundary:function(){return this.get("extendedBoundary")||this.get("parentElement");},_setBoundaryVars:function(){this._boundaryRegion=this._boundary.get("region");},_afterParentElementChanged:function(l){this._setBoundaryVars();this._parentRegion=this.get("parentElement").get("region");},_afterExtendedBoundaryChanged:function(l){this._setBoundaryVars();},_setRealWidthAndHeight:function(){var l=this.get("boundingBox").get("region");
this._realWidth=l.right-l.left;this._realHeight=l.bottom-l.top;},getOffsets:function(){var l=this.get("boundingBox").get("region");return[l.left-this._parentRegion.left,l.top-this._parentRegion.top];},setPosition:function(p){var o=this.get("boundingBox").get("region"),n=o.right-o.left,m=o.bottom-o.top,l=p[0]-(n/2),q=p[1]-(m/2);this.move(l,q);}});},"@VERSION@",{skinnable:true,requires:["node","widget"]});