YUI.add("gallery-form",function(C){function I(){I.superclass.constructor.apply(this,arguments);}C.mix(I,{NAME:"form",ATTRS:{method:{value:"post",validator:function(M){return this._validateMethod(M);},setter:function(M){return M.toLowerCase();}},action:{value:"",validator:C.Lang.isString},fields:{writeOnce:true,validator:function(M){return this._validateFields(M);},setter:function(M){return this._setFields(M);}},inlineValidation:{value:false,validator:C.Lang.isBoolean}},HTML_PARSER:{action:function(M){return this._parseAction(M);},method:function(M){return this._parseMethod(M);},fields:function(M){return this._parseFields(M);}},FORM_TEMPLATE:"<form></form>"});C.extend(I,C.Widget,{_formNode:null,_ioIds:null,_validateMethod:function(M){if(!C.Lang.isString(M)){return false;}if(M.toLowerCase()!="get"&&M.toLowerCase()!="post"){return false;}return true;},_validateFields:function(N){if(!C.Lang.isArray(N)){return false;}var M=true;C.Array.each(N,function(Q,P,O){if((!Q instanceof C.FormField)||(!C.Lang.isObject(Q))){M=false;}});return M;},_setFields:function(M){M=M||[];var N,O;C.Array.each(M,function(R,Q,P){if(!R._classes){O=R.type;if(C.Lang.isFunction(O)){N=O;}else{if(O=="hidden"){N=C.HiddenField;}else{if(O=="checkbox"){N=C.CheckboxField;}else{if(O=="password"){N=C.PasswordField;}else{if(O=="textarea"){N=C.TextareaField;}else{if(O=="select"){N=C.SelectField;}else{if(O=="choice"){N=C.ChoiceField;}else{if(O=="button"||O=="submit"||O=="reset"){N=C.Button;if(O=="submit"){R.onclick={fn:this.submit,scope:this};}else{if(O=="reset"){R.onclick={fn:this.reset,scope:this};}}}else{N=C.TextField;}}}}}}}}M[Q]=new N(R);}},this);return M;},_parseAction:function(M){var N=M.one("form");if(N){return N.get("action");}},_parseMethod:function(M){var N=M.one("form");if(N){return N.get("method");}},_parseFields:function(N){var O=N.all("*"),P=N.all("label"),M=[];O.each(function(S,R,Q){var W=S.get("nodeName"),U=S.get("id"),T,V=[];if(W=="INPUT"){T={type:S.get("type"),name:S.get("name"),value:S.get("value"),checked:S.get("checked")};if(T.type=="submit"||T.type=="reset"||T.type=="button"){T.label=S.get("value");}}else{if(W=="BUTTON"){T={type:"button",name:S.get("name"),label:S.get("innerHTML")};}else{if(W=="SELECT"){S.all("option").each(function(Y,Z,X){V.push({label:Y.get("innerHTML"),value:Y.get("value")});});T={type:"select",name:S.get("name"),choices:V};}else{if(W=="TEXTAREA"){T={type:"textarea",name:S.get("name"),value:S.get("innerHTML")};}}}}if(T){if(U){T.id=U;P.some(function(Y,Z,X){if(Y.get("htmlFor")==U){T.label=Y.get("innerHTML");}});}M.push(T);}S.remove();});return M;},_renderFormNode:function(){var M=this.get("contentBox"),N=M.query("form");if(!N){N=C.Node.create(I.FORM_TEMPLATE);M.appendChild(N);}this._formNode=N;},_renderFormFields:function(){var M=this.get("fields");C.Array.each(M,function(P,O,N){P.render(this._formNode);},this);},_syncFormAttributes:function(){this._formNode.setAttrs({action:this.get("action"),method:this.get("method"),id:this.get("id")});},_runValidation:function(){var M=this.get("fields"),N=true;C.Array.each(M,function(Q,P,O){Q.set("error",null);if(Q.validateField()===false){N=false;}});return N;},_enableInlineValidation:function(){var M=this.get("fields");C.Array.each(M,function(P,O,N){P.set("validateInline",true);});},_disableInlineValidation:function(){var M=this.get("fields");C.Array.each(M,function(P,O,N){P.set("validateInline",false);});},_handleIOSuccess:function(M,N){if(typeof this._ioIds[M]!="undefined"){delete this._ioIds[M];this.fire("success",{response:N});}},_handleIOFailure:function(M,N){if(typeof this._ioIds[M]!="undefined"){this.fire("failure",{response:N});delete this._ioIds[M];}},reset:function(){this._formNode.reset();var M=this.get("fields");C.Array.each(M,function(P,O,N){P.clear();P.set("error",null);});},submit:function(){if(this._runValidation()){var P=this.get("action"),Q=this.get("method"),M=this.get("fields"),O="",R,N;C.Array.each(M,function(U,T,S){if(U.get("name")!==null){O+=encodeURIComponent(U.get("name"))+"="+(encodeURIComponent(U.get("value"))||"")+"&";}});N={method:Q,data:O};R=C.io(P,N);this._ioIds[R.id]=R;}},getField:function(N){var M=this.get("fields"),O;if(C.Lang.isNumber(N)){return M[N];}else{if(C.Lang.isString(N)){C.Array.each(M,function(R,Q,P){if(R.get("name")==N){O=R;}});return O;}}},initializer:function(M){this._ioIds={};this.publish("submit");this.publish("reset");this.publish("success");this.publish("failure");},destructor:function(){this._formNode=null;},renderUI:function(){this._renderFormNode();this._renderFormFields();},bindUI:function(){this._formNode.on("submit",C.bind(function(M){M.halt();},this));this.after("inlineValidationChange",C.bind(function(M){if(M.newValue===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));this.after("success",C.bind(function(M){this.reset();},this));C.on("io:success",C.bind(this._handleIOSuccess,this));C.on("io:failure",C.bind(this._handleIOFailure,this));},syncUI:function(){this._syncFormAttributes();if(this.get("inlineValidation")===true){this._enableInlineValidation();}}});C.Form=I;function D(){D.superclass.constructor.apply(this,arguments);}C.mix(D,{NAME:"form-field",ATTRS:{id:{value:C.guid(),validator:C.Lang.isString,writeOnce:true},name:{validator:C.Lang.isString,writeOnce:true},value:{value:"",validator:C.Lang.isString},label:{value:"",validator:C.Lang.isString},validator:{value:function(M){return true;},validator:function(M){return this._validateValidator(M);},setter:function(M){return this._setValidator(M);}},error:{value:false,validator:function(M){return this._validateError(M);}},required:{value:false,validator:C.Lang.isBoolean},validateInline:{value:false,validator:C.Lang.isBoolean}},tabIndex:1,VALIDATE_EMAIL_ADDRESS:function(O,N){var M=/^([\w]+(?:\.[\w]+)*)@((?:[\w]+\.)*\w[\w]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(M.test(O)===false){N.set("error",D.INVALID_EMAIL_MESSAGE);return false;}return true;},INVALID_EMAIL_MESSAGE:"Please enter a valid email address",VALIDATE_PHONE_NUMBER:function(O,N){var M=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;
if(M.test(O)===false){N.set("error",D.INVALID_PHONE_NUMBER);return false;}return true;},INVALID_PHONE_NUMBER:"Please enter a valid phone number",VALIDATE_IP_ADDRESS:function(Q,P){var N=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/,M,O=true;if(N.test(Q)===false){O=false;}M=Q.split(".");C.Array.each(M,function(S,T,R){var U=parseInt(S,10);if(U<0||U>255){O=false;}});if(O===false){P.set("error",D.INVALID_IP_MESSAGE);}return O;},INVALID_IP_MESSAGE:"Please enter a valid IP address",VALIDATE_DATE:function(O,N){var M=/^([1-9]|1[0-2])(\-|\/)([0-2][0-9]|3[0-1])(\-|\/)(\d{4}|\d{2})$/;if(M.test(O)===false){N.set("error",D.INVALID_DATE_MESSAGE);return false;}return true;},INVALID_DATE_MESSAGE:"Please enter a a valid date",VALIDATE_TIME:function(O,N){var M=/^([1-9]|1[0-2]):[0-5]\d(:[0-5]\d(\.\d{1,3})?)?$/;if(M.test(O)===false){N.set("error",D.INVALID_TIME_MESSAGE);return false;}return true;},INVALID_TIME_MESSAGE:"Please enter a valid time",VALIDATE_POSTAL_CODE:function(P,O){var M,N=true;if(P.length==6||P.length==7){M=/^[a-zA-Z]\d[a-zA-Z](-|\s)?\d[a-zA-Z]\d$/;}else{if(P.length==5||P.length==10){M=/^\d{5}((-|\s)\d{4})?$/;}else{if(P.length>0){N=false;}}}if(N===false||(M&&M.test(P)===false)){O.set("error",D.INVALID_POSTAL_CODE_MESSAGE);return false;}return true;},INVALID_POSTAL_CODE_MESSAGE:"Please enter a valid postal code",VALIDATE_NO_SPECIAL_CHARS:function(O,N){var M=/^[a-zA-Z0-9]*$/;if(M.test(O)===false){N.set("error",D.INVALID_SPECIAL_CHARS);return false;}return true;},INVALID_SPECIAL_CHARS:"Please use only letters and numbers",INPUT_TEMPLATE:"<input>",TEXTAREA_TEMPLATE:"<textarea></textarea>",LABEL_TEMPLATE:"<label></label>",SELECT_TEMPLATE:"<select></select>"});C.extend(D,C.Widget,{_labelNode:null,_fieldNode:null,_errorNode:null,_nodeType:"text",_validateError:function(M){if(C.Lang.isString(M)){return true;}if(M===null||typeof M=="undefined"){return true;}return false;},_validateValidator:function(N){if(C.Lang.isString(N)){var M=/^(email|phone|ip|date|time|postal|special)$/;if(M.test(N)===true){return true;}}if(C.Lang.isFunction(N)){return true;}return false;},_setValidator:function(M){if(M=="email"){return D.VALIDATE_EMAIL_ADDRESS;}else{if(M=="phone"){return D.VALIDATE_PHONE_NUMBER;}else{if(M=="ip"){return D.VALIDATE_IP_ADDRESS;}else{if(M=="date"){return D.VALIDATE_DATE;}else{if(M=="time"){return D.VALIDATE_TIME;}else{if(M=="postal"){return D.VALIDATE_POSTAL_CODE;}else{if(M=="special"){return D.VALIDATE_NO_SPECIAL_CHARS;}}}}}}}return M;},_renderLabelNode:function(){var M=this.get("contentBox"),N=M.query("label");if(!N||N.get("for")!=this.get("id")){N=C.Node.create(D.LABEL_TEMPLATE);M.appendChild(N);}this._labelNode=N;},_renderFieldNode:function(){var M=this.get("contentBox"),N=M.query("#"+this.get("id"));if(!N){N=C.Node.create(D.INPUT_TEMPLATE);M.appendChild(N);}this._fieldNode=N;},_syncLabelNode:function(){if(this._labelNode){this._labelNode.setAttrs({innerHTML:this.get("label")});this._labelNode.setAttribute("for",this.get("id"));}},_syncFieldNode:function(){this._fieldNode.setAttrs({name:this.get("name"),type:this._nodeType,id:this.get("id"),value:this.get("value")});this._fieldNode.setAttribute("tabindex",D.tabIndex);D.tabIndex++;},_syncError:function(){var M=this.get("error");if(M){this._showError(M);}},_checkRequired:function(){if(this.get("required")===true&&this.get("value").length===0){return false;}return true;},_showError:function(N){var M=this.get("contentBox"),O=C.Node.create("<span>"+N+"</span>");O.addClass("error");M.insertBefore(O,this._labelNode);this._errorNode=O;},_clearError:function(){if(this._errorNode){var M=this.get("contentBox");M.removeChild(this._errorNode);this._errorNode=null;}},_enableInlineValidation:function(){this.after("valueChange",C.bind(this.validateField,this));},_disableInlineValidation:function(){this.detach("valueChange",this.validateField,this);},validateField:function(O){var N=this.get("value"),M=this.get("validator");this.set("error",null);if(O&&O.src!="ui"){return false;}if(!this._checkRequired()){this.set("error","This field is required");return false;}else{if(!N){return true;}}return M.call(this,N,this);},clear:function(){this.set("value","");this._fieldNode.set("value","");},initializer:function(){this.publish("blur");this.publish("change");this.publish("focus");},destructor:function(M){},renderUI:function(){this._renderLabelNode();this._renderFieldNode();},bindUI:function(){this._fieldNode.on("change",C.bind(function(M){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("change",M);},this));this.on("valueChange",C.bind(function(M){if(M.src!="ui"){this._fieldNode.set("value",M.newVal);}},this));this._fieldNode.on("blur",C.bind(function(M){this.set("value",this._fieldNode.get("value"),{src:"ui"});this.fire("blur",M);},this));this._fieldNode.on("focus",C.bind(function(M){this.fire("focus",M);},this));this.on("errorChange",C.bind(function(M){if(M.newVal){this._showError(M.newVal);}else{this._clearError();}},this));this.on("validateInlineChange",C.bind(function(M){if(M.newVal===true){this._enableInlineValidation();}else{this._disableInlineValidation();}},this));},syncUI:function(){this.get("boundingBox").removeAttribute("tabindex");this._syncLabelNode();this._syncFieldNode();this._syncError();if(this.get("validateInline")===true){this._enableInlineValidation();}}});C.FormField=D;function J(){J.superclass.constructor.apply(this,arguments);}C.mix(J,{NAME:"text-field"});C.extend(J,C.FormField,{_nodeType:"text"});C.TextField=J;function A(){A.superclass.constructor.apply(this,arguments);}C.mix(A,{NAME:"password-field"});C.extend(A,C.FormField,{_nodeType:"password"});C.PasswordField=A;function F(){F.superclass.constructor.apply(this,arguments);}C.mix(F,{NAME:"checkbox-field",ATTRS:{"checked":{value:false,validator:C.Lang.isBoolean}}});C.extend(F,C.FormField,{_nodeType:"checkbox",_getValue:function(N,M){if(this.get("checked")===true){return N;}else{return"";}},_syncChecked:function(){this._fieldNode.set("checked",this.get("checked"));},initializer:function(){F.superclass.initializer.apply(this,arguments);
this.modifyAttr("value",{getter:function(N,M){return this._getValue(N,M);},writeOnce:true});},renderUI:function(){this._renderFieldNode();this._renderLabelNode();},syncUI:function(){F.superclass.syncUI.apply(this,arguments);this._syncChecked();},bindUI:function(){F.superclass.bindUI.apply(this,arguments);this.after("checkedChange",C.bind(function(M){if(M.src!="ui"){this._fieldNode.set("checked",M.newVal);}},this));this._fieldNode.after("change",C.bind(function(M){this.set("checked",M.currentTarget.get("checked"),{src:"ui"});},this));}});C.CheckboxField=F;function E(){E.superclass.constructor.apply(this,arguments);}C.mix(E,{NAME:"radio-field"});C.extend(E,C.CheckboxField,{_nodeType:"radio"});C.RadioField=E;function L(){L.superclass.constructor.apply(this,arguments);}C.mix(L,{NAME:"hidden-field",ATTRS:{displayValue:{value:false,writeOnce:true,validator:C.Lang.isBoolean}}});C.extend(L,C.FormField,{_nodeType:"hidden",_valueDisplayNode:null,_renderValueDisplayNode:function(){if(this.get("displayValue")===true){var N=C.Node.create("<div></div>"),M=this.get("contentBox");M.appendChild(N);this._valueDisplayNode=N;}},renderUI:function(){L.superclass.renderUI.apply(this,arguments);this._renderValueDisplayNode();},bindUI:function(){L.superclass.bindUI.apply(this,arguments);if(this.get("displayValue")===true){this.after("valueChange",C.bind(function(M,N){this._valueDisplayNode.set("innerHTML",N.newVal);},this,true));}},clear:function(){}});C.HiddenField=L;function G(){G.superclass.constructor.apply(this,arguments);}C.mix(G,{NAME:"textarea-field",NODE_TEMPLATE:"<textarea></textarea>"});C.extend(G,C.FormField,{_renderFieldNode:function(){var M=this.get("contentBox"),N=M.query("#"+this.get("id"));if(!N){N=C.Node.create(C.substitute(G.NODE_TEMPLATE,{name:this.get("name"),type:"text",id:this.get("id"),value:this.get("value")}));M.appendChild(N);}N.setAttribute("tabindex",C.FormField.tabIndex);C.FormField.tabIndex++;this._fieldNode=N;}});C.TextareaField=G;function K(){K.superclass.constructor.apply(this,arguments);}C.mix(K,{NAME:"choice-field",ATTRS:{choices:{validator:function(M){return this._validateChoices(M);}},multiple:{validator:C.Lang.isBoolean,value:false}}});C.extend(K,C.FormField,{_validateChoices:function(O){if(!C.Lang.isArray(O)){return false;}var N=0,M=O.length;for(;N<M;N++){if(!C.Lang.isObject(O[N])){delete O[N];continue;}if(!O[N].label||!C.Lang.isString(O[N].label)||!O[N].value||!C.Lang.isString(O[N].value)){delete O[N];continue;}}if(O.length===0){return false;}return true;},_renderLabelNode:function(){var M=this.get("contentBox"),N=C.Node.create("<span>"+this.get("label")+"</span>");M.appendChild(N);this._labelNode=N;},_renderFieldNode:function(){var M=this.get("contentBox"),N=this.get("choices");C.Array.each(N,function(T,R,Q){var P={value:T.value,id:(this.get("id")+"_choice"+R),name:this.get("name"),label:T.label},O=(this.get("multiple")===true?C.CheckboxField:C.RadioField),S=new O(P);S.render(M);},this);this._fieldNode=M.all("input");},_syncFieldNode:function(){},clear:function(){this._fieldNode.each(function(N,M,O){N.setAttribute("checked",false);},this);this.set("value","");},bindUI:function(){this._fieldNode.on("change",C.bind(function(M){this._fieldNode.each(function(O,N,P){if(O.get("checked")===true){this.set("value",O.get("value"));}},this);},this));}});C.ChoiceField=K;function B(){B.superclass.constructor.apply(this,arguments);}C.mix(B,{NAME:"select-field",NODE_TEMPLATE:"<select></select>",OPTION_TEMPLATE:"<option></option>"});C.extend(B,C.ChoiceField,{_renderFieldNode:function(){var M=this.get("contentBox"),N=M.query("#"+this.get("id"));if(!N){N=C.Node.create(B.NODE_TEMPLATE);M.appendChild(N);}this._fieldNode=N;this._renderOptionNodes();},_renderOptionNodes:function(){var N=this.get("choices"),M;M=C.Node.create(B.OPTION_TEMPLATE);this._fieldNode.appendChild(M);C.Array.each(N,function(Q,P,O){M=C.Node.create(B.OPTION_TEMPLATE);this._fieldNode.appendChild(M);},this);},_syncFieldNode:function(){B.superclass.constructor.superclass._syncFieldNode.apply(this,arguments);this._fieldNode.setAttrs({multiple:(this.get("multiple")===true?"multiple":"")});},_syncOptionNodes:function(){var O=this.get("choices"),M=this.get("contentBox"),N=M.all("option");N.each(function(S,R,Q){var P=(R===0?"Choose one":O[R-1].label),T=(R===0?"":O[R-1].value);S.setAttrs({innerHTML:P,value:T});},this);},clear:function(){this._fieldNode.value="";},bindUI:function(){B.superclass.constructor.superclass.bindUI.apply(this,arguments);},syncUI:function(){B.superclass.syncUI.apply(this,arguments);this._syncOptionNodes();}});C.SelectField=B;function H(){H.superclass.constructor.apply(this,arguments);}C.mix(H,{NAME:"button",HTML_PARSER:{},ATTRS:{onclick:{validator:function(M){if(C.Lang.isObject(M)===false){return false;}if(typeof M.fn=="undefined"||C.Lang.isFunction(M.fn)===false){return false;}return true;},value:{fn:function(M){}},setter:function(M){M.scope=M.scope||this;M.argument=M.argument||{};return M;}}},NODE_TEMPLATE:"<button></button>"});C.extend(H,C.FormField,{_renderButtonNode:function(){var M=this.get("contentBox"),N;N=C.Node.create(H.NODE_TEMPLATE);M.appendChild(N);this._fieldNode=N;},_syncLabelNode:function(){},_syncFieldNode:function(){this._fieldNode.setAttrs({innerHTML:this.get("label"),id:this.get("id")});},_setClickHandler:function(){if(!this._fieldNode){return;}var M=this.get("onclick");C.Event.purgeElement(this._fieldNode,true,"click");C.on("click",C.bind(M.fn,M.scope,true),this._fieldNode);},renderUI:function(){this._renderButtonNode();},bindUI:function(){this.after("onclickChange",C.bind(this._setClickHandler,this,true));this._setClickHandler();}});C.Button=H;},"@VERSION@",{requires:["node","widget","io-base"]});